<svg width="1200" height="630" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <rect width="100%" height="100%" fill="#ffffff" />
  
  <defs>
    <clipPath id="circleView">
      <circle cx="90" cy="90" r="40" />
    </clipPath>
  </defs>
  <image x="50" y="50" width="80" height="80" xlink:href="<%= @account_icon_base64 %>" clip-path="url(#circleView)" />
  
  <text x="150" y="85" font-family="Noto Sans CJK JP" font-size="32" font-weight="bold" fill="#333">
    <%= @post.account.name %>
  </text>
  <text x="150" y="120" font-family="Noto Sans CJK JP" font-size="24" fill="#888">
    @<%= @post.account.name_id %>
  </text>

  <% max_lines = @post_drawing_base64 ? 2 : 6 %>
  <% lines = @post.content.scan(/.{1,27}/) %>
  <% if lines.size > max_lines %>
    <% lines[max_lines - 1] = lines[max_lines - 1][0...-1] + "â€¦" %>
  <% end %>
  <% lines.first(max_lines).each_with_index do |line, index| %>
    <text x="50" y="<%= 200 + (index * 50) %>" font-family="Noto Sans CJK JP" font-size="40" fill="#000">
      <%= line %>
    </text>
  <% end %>

  <% if @post_drawing_base64 %>
    <%
      line_count = lines.first(max_lines).size
      start_y = 160 + (line_count * 50)
      start_y += 20 if line_count > 0

      img_w = 800
      img_h = 300
      img_x = 50
      img_y = start_y
    %>
    <rect x="<%= img_x %>" y="<%= img_y %>" width="<%= img_w %>" height="<%= img_h %>" fill="none" stroke="#e0e0e0" stroke-width="2" />
    <image x="<%= img_x %>" y="<%= img_y %>" width="<%= img_w %>" height="<%= img_h %>" xlink:href="<%= @post_drawing_base64 %>" preserveAspectRatio="xMidYMid meet" />
  <% end %>

  <svg x="870" y="530" width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clip-path="url(#clip0_138_2)">
  <path d="M37.7072 29.3479C49.1869 6.05762 84.1671 13.5399 85.1146 39.4883L86.5873 79.8175C86.6907 82.6486 84.4236 85 81.5906 85H18.3154C14.6109 85 12.1928 81.1122 13.8306 77.7895L37.7072 29.3479Z" fill="url(#paint0_linear_138_2)"/>
  <ellipse cx="49.4637" cy="42.3818" rx="8" ry="12.5" transform="rotate(7 49.4637 42.3818)" fill="#F9FFEE"/>
  <ellipse cx="50.877" cy="41.7018" rx="5.8" ry="9.0625" transform="rotate(7 50.877 41.7018)" fill="black"/>
  <ellipse cx="68.4637" cy="44.3818" rx="8" ry="12.5" transform="rotate(7 68.4637 44.3818)" fill="#F9FFEE"/>
  <ellipse cx="66.9719" cy="43.5755" rx="5.72452" ry="8.94456" transform="rotate(7 66.9719 43.5755)" fill="black"/>
  <path d="M40.686 69.5969C42.6359 66.139 46.2977 64 50.2675 64H54.3116C59.4052 64 63.8326 67.497 65.0124 72.4522L68 85H32L40.686 69.5969Z" fill="#F7FFE7"/>
  </g>
  <defs>
  <linearGradient id="paint0_linear_138_2" x1="52" y1="13" x2="75.5" y2="94" gradientUnits="userSpaceOnUse">
  <stop stop-color="#87FF60"/>
  <stop offset="1" stop-color="#59A63F"/>
  </linearGradient>
  <clipPath id="clip0_138_2">
  <rect width="100" height="100" fill="white"/>
  </clipPath>
  </defs>
  </svg>

  <text x="950" y="580" font-family="Noto Sans CJK JP" font-size="30" fill="#373737ff" font-weight="bold">
    Amiverse.net
  </text>
</svg>
